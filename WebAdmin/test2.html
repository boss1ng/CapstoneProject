<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <!-- Firebase Libraries -->
    <script src="https://www.gstatic.com/firebasejs/6.0.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/6.0.2/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/6.0.2/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/6.0.2/firebase-storage.js"></script>
</head>
<body>

    <input type="text" id="catName" /></br>
    <input type="file" id="photo" /></br>
    <button id="upload">Upload Image</button>

    <img src="" id="imageDatabase">

    

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.2.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.2.0/firebase-analytics.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries
    
        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
          apiKey: "AIzaSyB08GrYWprzzbddoHqvTR5Ln-9i0CEXqHs",
          authDomain: "capstone-project-ffe21.firebaseapp.com",
          databaseURL: "https://capstone-project-ffe21-default-rtdb.asia-southeast1.firebasedatabase.app",
          projectId: "capstone-project-ffe21",
          storageBucket: "capstone-project-ffe21.appspot.com",
          messagingSenderId: "67612839105",
          appId: "1:67612839105:web:7d8ffd05e13733ef609840",
          measurementId: "G-2BJMTCZ2SM"
        };
    
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);

        import {getDatabase, set, get, update, remove, ref, child}
        from "https://www.gstatic.com/firebasejs/10.2.0/firebase-database.js"
        
        const db = getDatabase();




        var buttonUpload = document.querySelector("#upload");
        buttonUpload.addEventListener('click', uploadImage);

        function uploadImage() {
            const categoryName = document.getElementById('catName').value;
            const fileInput = document.getElementById('photo');
            var uploadedFile = fileInput.files[0]; // Get the selected file
            var fileInputName = uploadedFile.name;

            // UPLOAD
            const storageRef = firebase.storage().ref("Categories/" + fileInputName).put(uploadedFile)
            .then(
                function(snapshot) {
                    alert("Success");
                    console.log('Image uploaded successfully');

                    storageRef.snapshot.ref.getDownloadURL()
                    .then(function(url) {
                        ImgUrl = url;

                        set(ref(db, "Pictures/" + categoryName), {
                            Name: categoryName,
                            Link: ImgUrl
                        })

                        .then( ()=>{
                            alert("SLAY")
                        })

                        .catch( (error)=> {
                            alert("Login Credentials Mismatch. Please try again.")
                        })
                    });

                    // set(ref(db, "Pictures/" + categoryName), {
                    //     Name: categoryName,
                    //     Link: uploadedFile
                    // })

                    // .then( ()=>{
                    //     alert("SLAY")
                    // })

                    // .catch( (error)=> {
                    //     alert("Login Credentials Mismatch. Please try again.")
                    // })
                }, 
                
                function() {
                    alert("KIMI");

                    // storageRef.snapshot.ref.getDownloadURL().then(function(url) {
                    //     ImgUrl = url;

                    //     set(ref(db, "Pictures/" + categoryName), {
                    //         Name: categoryName,
                    //         Link: ImgUrl
                    //     })

                    //     .then( ()=>{
                    //         alert("SLAY")
                    //     })

                    //     .catch( (error)=> {
                    //         alert("Login Credentials Mismatch. Please try again.")
                    //     })
                        
                    //     // setCategoryURL(categoryName, ImgUrl);

                    //     // firebase.database().ref("Pictures/" + categoryName).set({
                    //     //     Name: categoryName,
                    //     //     Link: ImgUrl
                    //     // });

                    //     // alert
                    // });
                }
            );



            
        }
    </script>


</body>
</html>